<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Performance Psychology Coach</title>
    
    <!-- PWA Configuration -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Performance Coach">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- Meta tags for better SEO and sharing -->
    <meta name="description" content="Elite AI Performance Psychology Coach with dual specialization in executive coaching and DMD family support">
    <meta property="og:title" content="Elite Performance Psychology Coach">
    <meta property="og:description" content="Advanced AI coach for performance optimization and family support">
    <meta property="og:image" content="icon-512.png">
    
    <!-- External Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e0e7ff 100%);
        }
        
        /* PWA Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #4f46e5;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading-screen">
        <div class="loading-spinner"></div>
        <h2 style="margin-top: 20px;">Loading Performance Coach...</h2>
        <p style="opacity: 0.8;">Initializing AI capabilities</p>
    </div>
    
    <!-- App Container -->
    <div id="root"></div>
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Hide loading screen when React app loads
        setTimeout(() => {
            document.getElementById('loading').style.display = 'none';
        }, 2000);
    </script>
    
    <!-- React App -->
    <script type="text/babel">
        const { useState } = React;
        const { 
            Send, Brain, TrendingUp, Target, AlertCircle, 
            Lightbulb, BarChart3, Clock, Volume2 
        } = lucide;

        const AdvancedPerformanceCoachAI = () => {
            const [messages, setMessages] = useState([
                {
                    role: "assistant",
                    content: "I'm your advanced performance psychology coach, designed to exceed Wendy Rhoades' capabilities. I maintain complete conversation memory, use evidence-based reasoning, and provide detailed implementation strategies.\n\n**Two specialized modes available:**\nüéØ **Performance Mode**: Executive coaching, high-pressure optimization, trading psychology\nü§ù **Family Support Mode**: DMD-related psychological support, family coping strategies, caregiver stress management\n\nWhat would you like to focus on today? You can switch between modes anytime or discuss both areas - I maintain full context across all our conversations.",
                    timestamp: new Date().toISOString()
                }
            ]);
            const [currentMessage, setCurrentMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [coachingMode, setCoachingMode] = useState('performance');
            const [conversationAnalysis, setConversationAnalysis] = useState({
                patterns: [],
                insights: [],
                recommendations: []
            });

            const speakText = (text) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9;
                    utterance.pitch = 1;
                    utterance.volume = 0.8;
                    speechSynthesis.speak(utterance);
                }
            };

            const handleSendMessage = async () => {
                if (!currentMessage.trim() || isLoading) return;

                const userMessage = { 
                    role: "user", 
                    content: currentMessage, 
                    timestamp: new Date().toISOString() 
                };
                setMessages(prev => [...prev, userMessage]);
                setCurrentMessage('');
                setIsLoading(true);

                try {
                    const fullConversationHistory = [...messages, userMessage];
                    
                    const prompt = `You are an ELITE performance psychology coach with dual specialization:
1. PERFORMANCE MODE: Executive coaching, high-pressure optimization, trading psychology
2. FAMILY SUPPORT MODE: DMD (Duchenne Muscular Dystrophy) psychological support, family coping, caregiver stress

Current mode: ${coachingMode}

CORE COMPETENCIES:
- Maintain COMPLETE conversation memory and reference ALL previous interactions
- Access to ALL historical psychological research and current real-world developments
- DUAL SPECIALIZATION: Performance psychology AND DMD family support
- Use rigorous logical reasoning with evidence-based psychological principles
- Provide detailed examples with step-by-step application instructions
- Analyze behavioral patterns across entire conversation history
- Give actionable strategies with implementation frameworks
- Speak in a conversational, authoritative tone

SPECIALIZATION MODES:
üéØ PERFORMANCE MODE: Executive coaching, high-pressure optimization, trading psychology, workplace performance
ü§ù FAMILY SUPPORT MODE: DMD psychological support, progressive condition coping, family dynamics, caregiver strategies

Current mode: ${coachingMode}

COMPLETE CONVERSATION HISTORY (analyze ALL messages for patterns):
${JSON.stringify(fullConversationHistory)}

ANALYSIS REQUIREMENTS:
1. HISTORICAL KNOWLEDGE: Draw from psychological research and performance optimization
2. SPECIALIZED FOCUS: Apply expertise from current mode (Performance or Family Support)
3. PATTERN RECOGNITION: Identify behavioral/performance patterns from conversation
4. EVIDENCE-BASED REASONING: Use established psychological principles
5. DETAILED IMPLEMENTATION: Provide specific, step-by-step instructions
6. LOGICAL REASONING: Explain WHY each strategy works
7. CONVERSATION INTEGRATION: Reference and build upon previous discussions
8. MODE-SPECIFIC EXPERTISE: Apply specialized knowledge for current focus

RESPONSE FORMAT - JSON with these fields:
{
  "response": "Your main conversational response (detailed, evidence-based, incorporating current knowledge)",
  "reasoning": "Your logical reasoning chain - explain WHY this works psychologically",
  "evidence": "Specific psychological principles/research that support your approach",
  "implementation": "Step-by-step detailed instructions considering current conditions",
  "patterns": "What patterns you've identified from our conversation history",
  "prediction": "What you predict will happen based on psychological principles",
  "followup": "Specific questions or areas to explore based on developments",
  "currentContext": "How current events or conditions impact this situation"
}

CRITICAL: Your response should be conversational and authoritative. Apply expertise from the current mode while maintaining awareness of the full person. Use "you" and "your" naturally. Reference specific details from previous messages.

FOR PERFORMANCE MODE: Focus on executive performance, decision-making, stress management, workplace optimization
FOR FAMILY SUPPORT MODE: Focus on DMD coping strategies, family dynamics, caregiver support, progressive condition management

Your entire response MUST be a single, valid JSON object. DO NOT include any text outside the JSON.`;

                    const response = await window.claude.complete(prompt);
                    const aiResponse = JSON.parse(response);
                    
                    const assistantMessage = {
                        role: "assistant",
                        content: aiResponse.response,
                        reasoning: aiResponse.reasoning,
                        evidence: aiResponse.evidence,
                        implementation: aiResponse.implementation,
                        patterns: aiResponse.patterns,
                        prediction: aiResponse.prediction,
                        followup: aiResponse.followup,
                        currentContext: aiResponse.currentContext,
                        timestamp: new Date().toISOString()
                    };

                    setMessages(prev => [...prev, assistantMessage]);
                    
                    setConversationAnalysis(prev => ({
                        patterns: [...prev.patterns, aiResponse.patterns],
                        insights: [...prev.insights, aiResponse.reasoning],
                        recommendations: [...prev.recommendations, aiResponse.implementation]
                    }));

                    speakText(aiResponse.response);
                    
                } catch (error) {
                    console.error('Error:', error);
                    setMessages(prev => [...prev, { 
                        role: "assistant", 
                        content: "I'm experiencing a processing error. Let me recalibrate and try again. Can you rephrase your question or provide more specific context?",
                        timestamp: new Date().toISOString()
                    }]);
                }

                setIsLoading(false);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            return (
                <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-slate-50 to-indigo-50 min-h-screen">
                    <div className="bg-white rounded-lg shadow-2xl overflow-hidden">
                        {/* Enhanced Header */}
                        <div className="bg-gradient-to-r from-indigo-600 via-purple-600 to-blue-700 text-white p-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <Brain className="w-10 h-10" />
                                    <div>
                                        <h1 className="text-3xl font-bold">Elite Performance Psychology Coach</h1>
                                        <p className="text-indigo-100">AI with complete historical knowledge + real-time awareness</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-2 text-sm">
                                        <Clock className="w-4 h-4" />
                                        <span>Full Memory ‚Ä¢ Historical Knowledge ‚Ä¢ Real-Time Updates</span>
                                    </div>
                                </div>
                            </div>
                            
                            {/* Mode Selector */}
                            <div className="mt-4 flex gap-3">
                                <button
                                    onClick={() => setCoachingMode('performance')}
                                    className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all ${
                                        coachingMode === 'performance' 
                                            ? 'bg-white text-indigo-600 font-semibold' 
                                            : 'bg-indigo-500 text-indigo-100 hover:bg-indigo-400'
                                    }`}
                                >
                                    <Target className="w-4 h-4" />
                                    Performance Mode
                                </button>
                                <button
                                    onClick={() => setCoachingMode('family')}
                                    className={`px-4 py-2 rounded-lg flex items-center gap-2 transition-all ${
                                        coachingMode === 'family' 
                                            ? 'bg-white text-indigo-600 font-semibold' 
                                            : 'bg-indigo-500 text-indigo-100 hover:bg-indigo-400'
                                    }`}
                                >
                                    <Brain className="w-4 h-4" />
                                    Family Support Mode
                                </button>
                            </div>
                        </div>

                        {/* Main Content Area */}
                        <div className="flex">
                            {/* Messages Panel */}
                            <div className="flex-1">
                                <div className="h-96 overflow-y-auto p-6 bg-gray-50">
                                    {messages.map((message, index) => (
                                        <div key={index} className={`mb-6 ${message.role === 'user' ? 'text-right' : 'text-left'}`}>
                                            <div className={`inline-block max-w-4xl ${
                                                message.role === 'user' 
                                                    ? 'bg-indigo-600 text-white p-4 rounded-lg' 
                                                    : 'bg-white text-gray-800 shadow-lg border rounded-lg'
                                            }`}>
                                                <p className="whitespace-pre-wrap text-base leading-relaxed">{message.content}</p>
                                                
                                                {message.role === 'assistant' && (
                                                    <button
                                                        onClick={() => speakText(message.content)}
                                                        className="mt-2 flex items-center gap-1 text-indigo-600 hover:text-indigo-800 text-sm"
                                                    >
                                                        <Volume2 className="w-4 h-4" />
                                                        Listen
                                                    </button>
                                                )}
                                                
                                                {/* Enhanced AI Response Details */}
                                                {message.role === 'assistant' && message.reasoning && (
                                                    <div className="mt-4 space-y-3">
                                                        {message.reasoning && (
                                                            <div className="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                                                <div className="flex items-center gap-2 text-blue-800 font-semibold mb-2">
                                                                    <Lightbulb className="w-4 h-4" />
                                                                    Psychological Reasoning
                                                                </div>
                                                                <p className="text-blue-700 text-sm">{message.reasoning}</p>
                                                            </div>
                                                        )}
                                                        
                                                        {message.evidence && (
                                                            <div className="p-4 bg-green-50 rounded-lg border-l-4 border-green-500">
                                                                <div className="flex items-center gap-2 text-green-800 font-semibold mb-2">
                                                                    <BarChart3 className="w-4 h-4" />
                                                                    Evidence Base
                                                                </div>
                                                                <p className="text-green-700 text-sm">{message.evidence}</p>
                                                            </div>
                                                        )}
                                                        
                                                        {message.implementation && (
                                                            <div className="p-4 bg-amber-50 rounded-lg border-l-4 border-amber-500">
                                                                <div className="flex items-center gap-2 text-amber-800 font-semibold mb-2">
                                                                    <Target className="w-4 h-4" />
                                                                    Implementation Strategy
                                                                </div>
                                                                <p className="text-amber-700 text-sm whitespace-pre-wrap">{message.implementation}</p>
                                                            </div>
                                                        )}
                                                        
                                                        {message.patterns && (
                                                            <div className="p-4 bg-purple-50 rounded-lg border-l-4 border-purple-500">
                                                                <div className="flex items-center gap-2 text-purple-800 font-semibold mb-2">
                                                                    <TrendingUp className="w-4 h-4" />
                                                                    Pattern Analysis
                                                                </div>
                                                                <p className="text-purple-700 text-sm">{message.patterns}</p>
                                                            </div>
                                                        )}
                                                        
                                                        {message.prediction && (
                                                            <div className="p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                                                                <div className="flex items-center gap-2 text-indigo-800 font-semibold mb-2">
                                                                    <AlertCircle className="w-4 h-4" />
                                                                    Predicted Outcome
                                                                </div>
                                                                <p className="text-indigo-700 text-sm">{message.prediction}</p>
                                                            </div>
                                                        )}
                                                        
                                                        {message.currentContext && (
                                                            <div className="p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                                                                <div className="flex items-center gap-2 text-red-800 font-semibold mb-2">
                                                                    <TrendingUp className="w-4 h-4" />
                                                                    Current Context
                                                                </div>
                                                                <p className="text-red-700 text-sm">{message.currentContext}</p>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                    
                                    {isLoading && (
                                        <div className="text-left">
                                            <div className="inline-block bg-white p-4 rounded-lg shadow-lg">
                                                <div className="flex items-center gap-2 text-gray-600">
                                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-indigo-600"></div>
                                                    <span>Analyzing patterns ‚Ä¢ Reasoning through evidence ‚Ä¢ Crafting detailed strategy...</span>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Enhanced Input */}
                                <div className="p-6 bg-white border-t">
                                    <div className="mb-3">
                                        <div className="text-sm text-gray-600 flex items-center gap-2">
                                            {coachingMode === 'performance' ? (
                                                <>
                                                    <Target className="w-4 h-4" />
                                                    <span>Performance Mode: Executive coaching, high-pressure optimization, workplace performance</span>
                                                </>
                                            ) : (
                                                <>
                                                    <Brain className="w-4 h-4" />
                                                    <span>Family Support Mode: DMD support, family coping strategies, caregiver psychology</span>
                                                </>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex gap-3">
                                        <textarea
                                            value={currentMessage}
                                            onChange={(e) => setCurrentMessage(e.target.value)}
                                            onKeyPress={handleKeyPress}
                                            placeholder={coachingMode === 'performance' 
                                                ? "Describe your performance challenges, work stress, decision-making issues, or optimization goals..."
                                                : "Share your DMD-related concerns, family dynamics, caregiver stress, or coping challenges..."
                                            }
                                            className="flex-1 p-4 border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500 text-base"
                                            rows="4"
                                            disabled={isLoading}
                                        />
                                        <button
                                            onClick={handleSendMessage}
                                            disabled={!currentMessage.trim() || isLoading}
                                            className="px-8 py-4 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center gap-2 font-semibold"
                                        >
                                            <Send className="w-5 h-5" />
                                            Analyze
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Enhanced Footer */}
                        <div className="bg-gradient-to-r from-gray-50 to-indigo-50 p-4 text-center">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <h4 className="font-semibold text-gray-800 mb-2">üéØ Performance Mode</h4>
                                    <div className="flex items-center justify-center gap-4 text-xs text-gray-600">
                                        <div className="flex items-center gap-1">
                                            <Target className="w-3 h-3" />
                                            <span>Executive Coaching</span>
                                        </div>
                                        <div className="flex items-center gap-1">
                                            <TrendingUp className="w-3 h-3" />
                                            <span>High-Pressure Optimization</span>
                                        </div>
                                        <div className="flex items-center gap-1">
                                            <BarChart3 className="w-3 h-3" />
                                            <span>Trading Psychology</span>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h4 className="font-semibold text-gray-800 mb-2">ü§ù Family Support Mode</h4>
                                    <div className="flex items-center justify-center gap-4 text-xs text-gray-600">
                                        <div className="flex items-center gap-1">
                                            <Brain className="w-3 h-3" />
                                            <span>DMD Support</span>
                                        </div>
                                        <div className="flex items-center gap-1">
                                            <AlertCircle className="w-3 h-3" />
                                            <span>Family Coping</span>
                                        </div>
                                        <div className="flex items-center gap-1">
                                            <Volume2 className="w-3 h-3" />
                                            <span>Caregiver Psychology</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<AdvancedPerformanceCoachAI />, document.getElementById('root'));
    </script>
</body>
</html>